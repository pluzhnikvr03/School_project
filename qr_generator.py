import qrcode  # –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è QR-–∫–æ–¥–æ–≤
import os  # –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π (—Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–æ–∫, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è)


# –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è QR-–∫–æ–¥–∞
def generate_qr_code(qr_data, folder="qrcodes"):  # qr_data - –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã –≤ QR-–∫–æ–¥; folder - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏, –∫—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å QR-–∫–æ–¥ (qrcodes)
    if not os.path.exists(folder):  # —Å–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
        os.makedirs(folder)  # makedirs —Å–æ–∑–¥–∞–µ—Ç –ø–∞–ø–∫—É –∏ –≤—Å–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –ø–∞–ø–∫–∏, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    
    qr = qrcode.make(str(qr_data))  # —Å–æ–∑–¥–∞–µ–º QR-–∫–æ–¥ –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    filename = f"{qr_data}.png"  # —Ñ–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞: –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ QR-–∫–æ–¥–∞ + —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .png
    filepath = os.path.join(folder, filename)  # —Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É: –ø–∞–ø–∫–∞ + –∏–º—è —Ñ–∞–π–ª–∞; os.path.join() —Å–æ–µ–¥–∏–Ω—è–µ—Ç –ø—É—Ç–∏ –¥–ª—è –ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
    qr.save(filepath)  # —Å–æ—Ö—Ä–∞–Ω—è–µ–º QR-–∫–æ–¥ –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ PNG
    
    return filepath  # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Ç—å –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É


# —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç QR-–∫–æ–¥ –∏–∑ —Ä–∞–∑–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –æ –∫–Ω–∏–≥–µ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç QR-–∫–æ–¥ (—É–¥–æ–±–Ω–æ, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –æ –∫–Ω–∏–≥–∞—Ö –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö)
def generate_qr_for_book(book_info, folder="qrcodes"):  # book_info - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–µ –≤ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ; folder - –ø–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è QR-–∫–æ–¥–∞
    if isinstance(book_info, dict):  # –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω —Å–ª–æ–≤–∞—Ä—å
        qr_data = book_info.get('qr_code', book_info.get('id', 'unknown'))
    elif isinstance(book_info, (list, tuple)):  # –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –∫–æ—Ä—Ç–µ–∂
        qr_data = book_info[0]  # –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –∫–∞–∫ QR-–∫–æ–¥
    else:  # –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–∞ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ —á–∏—Å–ª–æ
        qr_data = str(book_info)  # –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É
    
    return generate_qr_code(qr_data, folder)  # –≤—ã–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞ —Å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏


# —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç QR-–∫–æ–¥—ã –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–Ω–∏–≥
def generate_all_qr_codes(books_list, folder="qrcodes"):  # books_list - —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ –≤ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ; folder - –ø–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö QR-–∫–æ–¥–æ–≤
  created_files = []  # —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—É—Ç–µ–π –∫ —Å–æ–∑–¥–∞–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º
    for book in books_list:  # –ø—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∫–Ω–∏–≥–∞–º –≤ —Å–ø–∏—Å–∫–µ
        try:  # –ø—ã—Ç–∞–µ–º—Å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∫–Ω–∏–≥–∏
            filename = generate_qr_for_book(book, folder)
            created_files.append(filename)  # –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, –¥–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤ —Å–ø–∏—Å–æ–∫
            print(f"–°–æ–∑–¥–∞–Ω QR-–∫–æ–¥: {os.path.basename(filename)}")  # –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ (os.path.basename() –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏)
        except Exception as e:  # –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            print(f"–û—à–∏–±–∫–∞ –¥–ª—è {book}: {e}")  # {book} - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–µ, {e} - —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
    
    return created_files  # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

if __name__ == "__main__":  # –±–ª–æ–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª—è –ø—Ä–∏ –ø—Ä—è–º–æ–º –∑–∞–ø—É—Å–∫–µ (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
    
    test_books = [                                     # c–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        ("TEST-001", "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫ 10", "–ê—Ñ–∞–Ω–∞—Å—å–µ–≤–∞", "2018"),       # –ö–æ—Ä—Ç–µ–∂
        {"qr_code": "TEST-002", "subject": "–ò—Å—Ç–æ—Ä–∏—è –Ω–æ–≤–≥–æ –≤—Ä–µ–º–µ–Ω–∏ 8"},  # –°–ª–æ–≤–∞—Ä—å
        "TEST-003",                                                     # –ü—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞
    ]
    
    print("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï QR-–ì–ï–ù–ï–†–ê–¢–û–†–ê")
    print("=" * 40)
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ QR-–∫–æ–¥—ã
    print("\n–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ QR-–∫–æ–¥—ã...")
    files = generate_all_qr_codes(test_books)  # –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö QR-–∫–æ–¥–æ–≤
    
    # –≤—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    print("\n" + "=" * 40)
    print(f"–°–æ–∑–¥–∞–Ω–æ {len(files)} QR-–∫–æ–¥–æ–≤ –≤ –ø–∞–ø–∫–µ qrcodes/")
    print("\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã:")
    
    # –≤—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    for file in files:
        print(f"  üìÑ {os.path.basename(file)}")  # –≤—ã–≤–æ–¥–∏–º —Ç–æ–ª—å–∫–æ –∏–º—è —Ñ–∞–π–ª–∞ (–±–µ–∑ –ø—É—Ç–∏ –∫ –ø–∞–ø–∫–µ)
    
    print("\n–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.")
